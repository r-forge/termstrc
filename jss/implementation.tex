\section[Software implementation in R]{Software implementation in \proglang{R}}
\label{sec:soft-impl}

In this section, we describe the implementation of the package \pkg{termstrc} in the \proglang{R} system for statistical computing. The matrix-oriented notation used in sections \ref{sec:zcy-estim}-\ref{sec:cubic-splines} can efficiently be realized with base \proglang{R} functions. In the following, we give an overview about the structure of our data sets, explain the ideas behind our core functions and describe the available \proglang{S3} classes and methods provided by the package.

\subsection{Structure of data sets}

The data sets in our package have the following structure. They are \code{"list"} objects, which contain sublists for the countries available in the data set. Each of them includes market data in the format described in Table~\ref{tab:dataset}. 

\begin{table}[htb]
  \centering
  \begin{tabular}[htb]{|l|l|}
\hline
    \textbf{Object} & \textbf{Description} \\
\hline
\code{ISIN} & International Securities Identifying Number (ISIN)\\
\code{MATURITYDATE} & maturity dates\\
\code{ISSUEDATE} & issue dates\\
\code{COUPONRATE} & coupon rates as percentage of nominal values\\
\code{PRICE} & observed market prices (clean prices)\\
\code{ACCRUED} & accrued interest\\
\code{TODAY} & date when market prices were observed\\\hline
\code{CASHFLOWS\$ISIN} & International Securities Identifying Number (ISIN)\\
\code{CASHFLOWS\$CF} & all cashflows for a given ISIN\\
\code{CASHFLOWS\$DATE} & maturity dates of all cashflows\\
\hline  
\end{tabular}
  \caption{Structure of a data set}
\label{tab:dataset}
\end{table}

The first part consists of the general specifications of the bonds and its market price and accrued interest. The sublist \code{CASHFLOWS} contains all cashflows for the available bonds sorted by their ISIN and their maturity dates. This data structure is very convenient when building the cash flow matrices and the maturity matrices defined in \ref{sec:notation}.

It is easy to convert data downloaded via common data provider, e.g. \emph{Thomson Datastream}\texttrademark\, to our format.\footnote{Thomson Datastream is one of the world's largest and most respected financial statistical databases. For more information see \url{http://www.datastream.com/}.} The goal is now to perform perform zero-coupon yield curve estimations with the two procedures mentioned in Section~\ref{sec:nels-svenss-meth} and \ref{sec:cubic-splines}.

\newpage
\subsection{Core functions}
\label{sec:main-functions}

For that purpose, the package \pkg{termstrc} provides two core functions and several helper functions. \code{nelson_estim()} performs the estimation according to the parametric \cite{Nelson1987} method with the \cite{Svensson1994} extension described in Section~\ref{sec:nels-svenss-meth}.  \code{splines_estim()} allows the user to estimate the term structure according the \cite{McCulloch1975} cubic splines approach described in Section~\ref{sec:cubic-splines}. Both of the core functions require a minimum amount of input. Table~\ref{tab:corefct} gives an overview about the similar types of arguments.

\begin{table}[htb]
 \centering
 \begin{tabular}[htb]{|l|l|c|c|}
%\begin{longtable}[htb]{|l|l|c|c|}
  \hline
  \textbf{Argument}    & \textbf{Description}     & \code{nelson_estim()}       & \code{splines_estim()} \\
  \hline
\multirow{2}{1in}{\code{group}} & vector defining the group & \multirow{2}{1in}{\centering \checkmark}& \multirow{2}{1in}{\centering \checkmark}\\
                                &  of bonds used for the estimation & & \\\hline
\code{bonddata} & data set of bonds in list format & \checkmark & \checkmark \\\hline
\code{matrange} & restrict maturity range & \checkmark & \checkmark\\\hline
\multirow{2}{1in}{\code{method}} & \code{"Nelson/Siegel"} &\multirow{2}{1in}{\centering \checkmark} & \\
                                 & or \code{"Svensson"} & &\\\hline
\multirow{2}{1in}{\code{fit}} & \code{"prices"} or \code{"yields"} for&\multirow{2}{1in}{\centering \checkmark} & \\
                              & minimized squared error & &\\\hline
\multirow{2}{1in}{\code{weights}} & \code{"none"} or&\multirow{2}{1in}{\centering \checkmark} & \\
                                  & \code{"duration"} & & \\\hline
\code{startparam} & matrix of start parameters & \checkmark & \\\hline
% \vspace{1cm}\\
% \caption{Input arguments for the core functions}
% \label{tab:corefct}
% \end{longtable}
\end{tabular}
\caption{Input arguments for the core functions}
\label{tab:corefct}
 \end{table}

\subsection{Helper functions}
\label{sec:helper-functions}

Our package contains many functions to perform typical fixed income mathematics operations. Table~\ref{tab:helpfct} shows the most important ones. Most of the calculations done by the the core functions are based on the helper functions. However, the helper functions can also be applied independently. The package includes serveral more functions. For a description of them we may refer to the technical documentation. 

\begin{table}[htb]
 \centering
 \begin{tabular}[htb]{|l|l|}
\hline
\textbf{Function name} & \textbf{Description}\\\hline
\code{create_cashflows_matrix()} & creates a cashflow matrix for a group of bonds\\\hline
\code{create_maturities_matrix()} & creates a maturities matrix for a group of bonds\\\hline
\multirow{2}{1in}{\code{duration()}} & calculates Macauly duration, modified duration\\
                                 &  and duration based weights \\\hline
\multirow{2}{1in}{\code{bond\_yields()}}  & calculates yield-to-maturities with\\
                     & \code{uniroot()} function\\\hline
\code{impl_fwr()} & implied forward rates from a given spot curve\\\hline
\end{tabular}
\caption{Most important helper functions}
\label{tab:helpfct}
 \end{table}

\subsection{Exploring the estimation results}
\label{sec:expl-estim-results}

The core functions return an object of the class \code{"nelson"} or \code{"cubicsplines"}. The package offers the common
\proglang{S3} plot, print and summary methods for these classes. The objects itself is a list and contains vectors and sublists as described in Table~\ref{tab:resultsobjct}. The sublists are structured according to the chosen countries in the \code{group} argument, e.g. \code{<object>$m$<COUNTRY>} returns the maturity matrix of \code{<COUNTRY>}. 

\begin{longtable}{|l|p{4in}|c|c|}
\hline
\textbf{Object}   & \textbf{Description} & \textbf{N/S} & \textbf{CS}\\
\hline\hline
\code{group}	   & group of bonds (e.g. countries) used for the estimation & \checkmark & \checkmark\\\hline
\code{matrange}    & \code{"none"} or a vector with the maturity range& \checkmark & \checkmark\\\hline
\code{method}      & estimation method (\code{"Nelson/Siegel"} or \code{"Svensson"})& \checkmark & \\\hline
\code{fit}         & objective function (\code{"prices"}, or \code{"yields"})& \checkmark & \\\hline
\code{weights}	   & weighting of the errors used in the optimization (\code{"none"} or \code{"duration"})& \checkmark & \\\hline
\code{n_group}	   & length of object \code{group}, i.e. the number of countries& \checkmark & \checkmark\\\hline
\code{knotpoints}  & selected knot points for the cubic splines estimation & & \checkmark\\\hline
\code{spot}	   & zero-coupon yield curves as object of the class \code{"spot_curves"}& \checkmark & \checkmark\\\hline
\code{spread}	   & spread curves as object of the class \code{"s_curves"}& \checkmark & \checkmark\\\hline
\code{forward}	   & forward curves as object of the class \code{"fwr_curves"}& \checkmark & \checkmark\\\hline
\code{discount}    & discount curves as object of the class \code{"df_curves"}& \checkmark & \checkmark\\\hline
\code{expoints}    & extrapolation points for Nelson/Siegel method& \checkmark & \\\hline
\code{cf}	   & cashflow matrices& \checkmark & \checkmark\\\hline
\code{m}	   & maturity matrices& \checkmark & \checkmark\\\hline
\code{p}	   & dirty prices& \checkmark & \checkmark\\\hline
\code{phat}	   & estimated bond prices& \checkmark & \checkmark\\\hline
\code{perrors}	   & pricing errors and maturities as object of the class \code{"error"}& \checkmark & \checkmark\\\hline
\code{y}	   & bond yields& \checkmark & \checkmark\\\hline
\code{yhat}	   & estimated bond yields calculated with \code{phat}& \checkmark & \checkmark\\\hline
\code{yerrors}     & yield errors and maturities as object of the class \code{"error"}& \checkmark & \checkmark\\\hline
\code{opt_result}  & optimization results from \code{nlminb}, e.g. optimal parameters, convergence info& \checkmark & \\\hline
\code{alpha}	   & OLS coefficients of cubic splines estimation&  & \checkmark\\\hline
\code{regout}	   & OLS estimation results as object of the class \code{"lm"}&  & \checkmark\\\hline
\caption{Contents of \code{nelson} and \code{cubicsplines} object}
\label{tab:resultsobjct}
\end{longtable}

The summary methods \code{summary.nelson()} and \code{summary.cubicsplines()} give goodness of fit measures, i.e. the RMSE and MAE for the pricing and yield errors. \code{summary.nelson()} additionally shows convergence information from the solver \code{nlminb()}.

The parameters for the cubic splines approach are estimated with OLS by using the \code{lm()} function. Therefore, \code{summary.cubicsplines()} also provides summary statistics for the OLS estimation by applying \code{summary.lm(<object>$regout)}. 

The print methods \code{print.nelson()} and \code{print.cubicsplines()} return the estimated parameters in a clearly arranged way.
As Table~\ref{tab:resultsobjct} shows, the returned object from our estimation itself contains objects of certain classes. For objects of the class \code{"spot_curves", "fwr_curves", "df_curves"} and \code{"error"} plot methods are available. They will be covered in the following section. For the sublists in \code{regout}, which are objects of the class \code{"lm"}, the standard methods for the \code{"lm"} class apply.  

\newpage
\subsection{Visualization of the results}
\label{sec:visu-results}

The \proglang{S3} plot methods \code{plot.nelson()} and \code{plot.cubicsplines()} offer the following possibilities:

\begin{itemize}
\item plot zero-coupon, forward, discount or spread curves
\item return single/multiple plots for the estimated group of bonds
\item show error plots for pricing/yield errors to identify outliers
\end{itemize}

Plots of the zero-coupon yield curve for a single country include additional information. In detail, 
also the yield-to-maturities are plotted and for objects of the class \code{"cubicsplines"} the knot points used for the estimationand the 95\% confidence intervall of the zero-coupon yield curve is plotted. 

Both plot methods depend on plot methods for the classes \code{"spot\_curves", "fwr\_curves"} and \code{"df\_curves"}. These plot methods are itself based on the plot method for the class \code{"ir\_curve"}, which is the most granular class.
A object of the class \code{"spot\_curves", "fwr\_curves"} or \code{"df\_curves"} can therefore consist of serveral 
objects of the class \code{"ir\_curve"}. The advantage for the user is, that when he
is exploring a \code{"nelson"} or \code{"cubicsplines"} object, he can plot the different curves at every hierarchical level of the object. For example, the command \code{plot(<object>$spot$<COUNTRY>)} creates a plot of the spot curve of \code{<COUNTRY>}, while \code{plot(<object>$spot)} plots the spot curves of all countries. 


\subsection{Perfomance issues}
\label{sec:perfomance-issues}

The implementation of the \pkg{termstrc} package is based on an efficent operation on the data sets in list format. We avoid programming loops by using apply-functions. The most time-consuming tasks are solving the nonlinear optimization problem for the \cite{Nelson1987} and \cite{Svensson1994} method and the ordinary least squares estimation of the \cite{McCulloch1975} cubic splines. In Section~\ref{sec:rolling-estim}, we will see results for a rolling estimation procedure performed on a large data set.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "jss-termstrc"
%%% End: 

