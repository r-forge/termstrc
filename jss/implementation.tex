\section[Software implementation in R]{Software implementation in \proglang{R}}
\label{sec:soft-impl}

\subsection{Structure of data sets}

The data sets in our package have the following structure. They are list objects, which contain sublists for the countries available in the data set. Each of them contains market data in the format described in Table~\ref{tab:dataset}. 

\begin{table}[htb]
  \centering
  \begin{tabular}[htb]{|l|l|}
\hline
    \textbf{Object} & \textbf{Description} \\
\hline
\code{ISIN} & International Securities Identifying Number (ISIN)\\
\code{MATURITYDATE} & maturity dates\\
\code{ISSUEDATE} & issue dates\\
\code{COUPONRATE} & coupon rate as percentage of nominal value\\
\code{PRICE} & observed market price (clean price)\\
\code{ACCRUED} & accrued interest\\
\code{TODAY} & date when market prices were observed\\\hline
\code{CASHFLOWS\$ISIN} & International Securities Identifying Number (ISIN)\\
\code{CASHFLOWS\$CF} & all cashflows for a given ISIN\\
\code{CASHFLOWS\$DATE} & maturity dates of all cashflows\\
\hline  
\end{tabular}
  \caption{Structure of a data set}
\label{tab:dataset}
\end{table}

The first part consists of the general specifications of the bonds and its market price and accrued interest. The sublist \code{CASHFLOWS} contains all cashflows for the available bonds sorted by their ISIN and the their maturity dates. This data structure is very convenient when building the cash flow matrix and the maturity matrix defined in \ref{sec:notation}.

It is easy to convert data downloaded via \emph{Thomson Datastream}\texttrademark\, to our format.\footnote{Thomson Datastream is the world's largest most respected financial statistical database. For more information see \url{http://www.datastream.com/}.} The goal is now to perform perform a zero-coupon yield curve estimation with the two procedures mentioned in Section~\ref{sec:nels-svenss-meth} and \ref{sec:cubic-splines}.

\subsection{Core functions}
\label{sec:main-functions}

The package \pkg{termstrc} consists of two core functions and several helper functions which perform other stuff. \code{nelson_estim()} and \code{splines_estim()} allow the user to perform the parametric Nelson/Siegel or Svensson estimation and the cubic splines. Table~\ref{tab:corefct} gives an overview about the similar input arguments of these functions.

\begin{table}[htb]
 \centering
 \begin{tabular}[htb]{|l|l|c|c|}
%\begin{longtable}[htb]{|l|l|c|c|}
  \hline
  \textbf{Argument}    & \textbf{Description}     & \code{nelson_estim()}       & \code{splines_estim()} \\
  \hline
\multirow{2}{1in}{\code{group}} & vector defining the group & \multirow{2}{1in}{\centering \checkmark}& \multirow{2}{1in}{\centering \checkmark}\\
                                &  of bonds used for the estimation & & \\\hline
\code{bonddata} & data set of bonds in a list format & \checkmark & \checkmark \\\hline
\code{matrange} & restrict maturity range & \checkmark & \checkmark\\\hline
\multirow{2}{1in}{\code{method}} & \code{"Nelson/Siegel"} &\multirow{2}{1in}{\centering \checkmark} & \\
                                 & or \code{"Svensson"} & &\\\hline
\multirow{2}{1in}{\code{fit}} & \code{"prices"} or \code{"yields"} for&\multirow{2}{1in}{\centering \checkmark} & \\
                              & minimized squared error & &\\\hline
\multirow{2}{1in}{\code{weights}} & \code{"none"} or&\multirow{2}{1in}{\centering \checkmark} & \\
                                  & \code{"duration"} & & \\\hline
\code{startparam} & matrix of start parameters & \checkmark & \\\hline
% \vspace{1cm}\\
% \caption{Input arguments for the core functions}
% \label{tab:corefct}
% \end{longtable}
\end{tabular}
\caption{Input arguments for the core functions}
\label{tab:corefct}
 \end{table}

\subsection{Helper functions}
\label{sec:helper-functions}

%\Bart Describe most important helper functions!

\subsection{Exploring the estimation results}
\label{sec:expl-estim-results}

%\Homer Describe S3 classes!

The core functions return an object of the class \code{"nelson"} or \code{"cubicsplines"}. The packages offers the common
\code{S3} plot, print and summary methods for these classes. The objects itself is a list and contains vectors and sublists as described in Table~\ref{tab:resultsobjct}. The sublists are structured according to the chosen countries, e.g. \code{<object>$m$<COUNTRY>} gives the maturity matrix of \code{<COUNTRY>}. 

\input{estimresults.tex}

The summary methods \code{summary.nelson} and \code{summary.cubicsplines} gives goodnes of fit measures, i.e. the RMSE and MAE for the pricing and yield errors. \code{summary.nelson} additionally shows convergence information from the solver \code{nlminb()}.
Because the estimation of the parameters for the cubic splines is based on OLS estimation \code{summary.cubicsplines} also provides the summary statistics of this estimation applying \code{summary.lm(<object>$regout)}. The print methods \code{print.nelson} and \code{print.cubicsplines} return the estimated parameters in a clearly arranged way.
As Table~\ref{tab:resultsobjct} shows the returned object itself contains object of certain classes. For objects of the class \code{"spot_curves", "fwr_curves", "df_curves"} and \code{"error"} plot methods are available. They will be covered in the following section. For sublists of \code{regout} which are objects of the class \code{"lm"} the standard \code{"lm"} methods apply.  

\subsection{Visualization of the results}
\label{sec:visu-results}

The S3 plot methods \code{plot.nelson} and \code{plot.cubicsplines} offer the following possibilities:

\begin{itemize}
\item plot zero-coupon, forward, discount or spread curves
\item return single/multiple plots for the estimated group of bonds
\item show error plots for pricing/yield errors to identify outliers
\end{itemize}

Both plot methods depend on plot methods of the classes \code{"spot_curves", "fwr_curves"} and \code{"df_curves"}. These plot methods are itself based on the plot method for the class \code{"ir_curve}. It is the most granular class. Objects of this class are curves of all named types of one country. The advantage for the user is, that when he
is exploring the \code{nelson} or \code{cubicsplines} object, he can at every hierarchical level plot the different curves. 
The command \code{plot(<object>$spot$<COUNTRY>)} for instance plots the spot curve of \code{<COUNTRY>}, \code{plot(<object>$spot)} will plot the spot curves of all countries. 


\subsection{Perfomance issues}
\label{sec:perfomance-issues}

The implementation of the \pkg{termstrc} package is based on an efficent operation on the data sets in list format. We avoid programming loops by using apply-functions. The most time-consuming tasks are solving the nonlinear optimization problem for \cite{Nelson1987} and \cite{Svensson1994} method and the ordinary least squares estimation of the \cite{McCulloch1975} cubic splines. In Section~\ref{sec:rolling-estim}, we will see results for a rolling estimation procedure performed on a large data set.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "jss-termstrc"
%%% End: 

