\newpage
\section{Cubic splines}
\label{sec:cubic-splines}

\begin{itemize}
\item parametric cubic splines \cite{McCulloch1971, McCulloch1975}
\item non-parametric splines \cite{Adams1994,Fisher1995, Waggoner1997, Tanggaard1997, Shea1985}
\item \cite{Shea1985} mentions unstable fluctuating forward rates in \cite{McCulloch1975} cubic splines

\end{itemize}

Discount function

\begin{equation}
  \label{eq:df_spline}
  d(m_{i,j},\bm{\beta})=1+\sum_{l=1}^k\beta^lg^l(m_{i,j})
\end{equation}


\subsection{Knot point selection}

\cite{McCulloch1975} defines a $k$-parameter spline with $k-1$ knot points $q_l$. We sort the cashflow matrix $\bm{C}$ and the maturity matrix $\bm{M}$ such that the $m$ bonds are arranged in ascending order by their maturity dates. The following specification places an approximately equal number of bonds between adjacent knots. It sets $q_1=0$ and $q_{k-1}=m_m$. $m_j$ is the maturity date of the $j$-th bond. For $1<l<k-1$ we find the further knot points.

\begin{equation}
  \label{eq:A.1a}
  q_l = m_h+\theta(m_{h+1}-m_h)
\end{equation}

where

\begin{equation}
 \label{eq:A.1b}
  h = \mbox{greates integer in }\frac{(l-1)m}{k-2}
\end{equation}

and

\begin{equation}
  \label{eq:A.1c}
  \theta = \frac{(l-1)m}{k-2}-h.
\end{equation}

\cite{McCulloch1971} sets the  number of basis functions $k$ to the integer nearest to the square root of the number of observed bonds. This allows a smooth fit of the discount function.

\begin{equation}
  \label{eq:nofknots}
  k = \mbox{INT}\left[\sqrt{m}\right]
\end{equation}


allgemeiner Satz über Funktionen ....
In order to generate the family of cubic splines relative to these knots, we define for $m_{ij}<q_{l-1}$

\begin{equation}
  \label{eq:A.2}
  g^l(m_{i,j})=0.
\end{equation}


For $q_{l-1}\leq m_{ij} <q_l$, we define

\begin{equation}
  \label{eq:A.3}
  g^l(m_{i,j})=\frac{(m_{ij}-q_{l-1})^3}{6(q_l-q_{l-1})}
\end{equation}

When $q_l\leq m_{ij}< q_{l+1}$, we define

\begin{equation}
  \label{eq:A.4a}
  g^l(m_{i,j}) = \frac{c^2}{6}+\frac{ce}{2}+\frac{e^2}{2}-\frac{e^3}{6(q_{l+1}-q_l)}
\end{equation}

where

\begin{equation}
  \label{eq:A.4b}
  c = q_l-q_{l-1}
\end{equation}

and $e$ is the 

\begin{equation}
  \label{eq:A.4c}
  e = m_{ij}-q_l
\end{equation}

For $q_{l+1}\leq m_{ij}$, define

\begin{equation}
  \label{eq:A.5}
  g^l(m_{i,j}) = (q_{l+1}-q_{l-1})\left[\frac{2q_{l+1}-q_l-q_{l-1}}{6}+\frac{m_{ij}-q_{l+1}}{2}\right]
\end{equation}

(Set $q_{l-1}=q_l=0$ when $l=1$.)

The above formulas apply when $l<k$. When $l=k$, we define

\begin{equation}
  \label{eq:A.6}
 g^l(m_{i,j})= m_{ij},
\end{equation}

regardless of $m_{ij}$.

The basis functions in equations \eqref{eq:A.2}-\eqref{eq:A.6} are calulated for the maturities of each cashflow $m_{i,j}$ and summarized in the matrix

\begin{equation}
\label{eq:basisfctmatrix}	
\bm{G}_{\left [n \times m\right]}^l= \{g_{ij}^l\}.
\end{equation}
where $g_{i,j}^l=g^l(m_{i,j})$.



\subsection{Regression fitting of the discount function}

The dirty prices are expressend as sum of the discounted cashflows plus an idiosyncratic error.

\begin{equation}
  \label{eq:fairpricespline}
  \bm{p}_{\left[1\times m\right]}= \bm{\iota}_{\left[1\times n\right]}\left(\bm{C}_{\left[n\times m\right]}\cdot\bm{D}_{\left[n\times m\right]}\right)+ \bm{\epsilon}_{\left[1\times m\right]}
\end{equation}

The discount factor matrix is expressed as weighted sum of the $l=1\dots k$ basis functions.

\begin{equation}
  \label{eq:dfmatrixspline}
   \bm{D}_{\left[n\times m\right]}=1+\beta_1\bm{G}^1+\cdots + \beta_k\bm{G}^k
\end{equation}

We substitute \eqref{eq:dfmatrixspline} in \eqref{eq:fairpricespline} and get an expression which is linear in the parameter vector $\bm{\beta}=(\beta^1,\dots,\beta^k)$.

\begin{eqnarray}
  \label{eq:splineparam}
  \bm{p} &=& \bm{\iota}\left(\bm{C}\cdot\left(1+\beta^1\bm{G}^1+\cdots+\beta^k\bm{G}^k\right)\right)+\bm{\epsilon}\\
  \bm{p} &=& \bm{\iota}\left(\bm{C}+\bm{C}\cdot\left(\beta^1\bm{G}^1+\cdots+\beta^k\bm{G}^k\right)\right)+\bm{\epsilon}\\
  \bm{p} &=& \bm{\iota}\bm{C}+\bm{\iota}\bm{C}\cdot\left(\beta^1\bm{G}^1+\cdots+\beta^k\bm{G}^k\right)+\bm{\epsilon}\\
  \bm{p}- \bm{\iota}\bm{C} &=& \beta^1\bm{\iota}\bm{C}\cdot\bm{G}^1+\cdots+\beta^k\bm{\iota}\bm{C}\cdot\bm{G}^k+\bm{\epsilon}
\end{eqnarray}



	$$\bm{X}_{\left[m \times k\right]}=\{ \bm{x}_{\left[m \times 1\right]} \} \qquad  \bm{x}_{\left[m \times 1\right]} = \left( \bm{\iota}\bm{C}\cdot\bm{G}^l\right)^\top$$


	$$\bm{y}_{\left[m \times 1\right]}= \left(\bm{p}-\bm{\iota}\bm{C}\right)^\top   $$
        \begin{equation}
          \label{eq:splinereg}
            \bm{y}=\bm{X}\bm{\beta}+\bm{\epsilon}
        \end{equation}
        
       

% 	$$\bm{X}_{\left[m \times k\right]}=\{ \bm{x}_{\left[m \times 1\right]} \} \qquad  \bm{x}_{\left[m \times 1\right]} = \left( \bm{\iota}_{\left[1\times n\right]} \bm{C}_{\left[n\times m\right]} \cdot \bm{G}^l_{\left[n\times m\right]}\right)^\top$$

% 	$$\bm{y}_{\left[m \times 1\right]}= \left(\bm{p}_{\left[1\times m\right]}  - \bm{\iota}_{\left[1\times n\right]} \bm{C}_{\left[n\times m\right]}\right)^\top   $$

Whereas $(\cdot)$ denotes again a element by element multiplication and $( )^{\top}$ the transposed matrix (vector).



Parameter estimation with OLS.
	
\begin{equation}
\label{eq:paramspline}
\bm{\hat \beta}_{\left[k \times 1\right]}= \left( \bm{X}^\top   \bm{X}\right )^{-1}\bm{X}^\top \bm{y}
\end{equation}

\textcolor{red}{Can OLS estimators be infeasible due to large amount of zeros in $\bm{X}$?}

The estimated parameters can be used to calculate the discount function in \eqref{eq:df_spline} for any given maturity $m$ between the first and the last knot point, which can then be converted to zero-coupon yields.



\begin{equation}
  \label{eq:transformdf}
  s(m,\bm{\beta}) = \frac{-\ln d(m,\bm{\beta})}{m}
\end{equation}


\subsection{Confidence Intervals}

\begin{equation}
  \label{eq:yhat}
  \bm{\hat{y}}=\bm{X}\bm{\hat{\beta}}
\end{equation}


\begin{equation}
  \label{eq:predint}
 \mbox{P}\left[\bm{\hat{y}}\pm t_{\alpha/2}\cdot \se(\bm{\hat{y}-y})\right]=0.95
\end{equation}


\begin{equation}
  \label{eq:printvdf}
  d(m_{i,j})=1+\sum_{l=1}^k\beta^lg^l(m_{i,j})
\end{equation}



\cite{Greene2002}
Under the assumption of a normal distributed disturbence term $\bm{\epsilon}$ the conditional distribution of $\bm{b}$ given $\bm{X}$ can be expressed as


\begin{equation}
  \label{eq:bddistrb}
  \bm{b}|\bm{X} \sim N\left[\bm{\hat \beta}, \sigma^2\bm{X^\top}\bm{X}^{-1}\right]
\end{equation}

If the elements of $\bm{\epsilon}$ are independently identically distributed with mean zero and finite variance $\sigma^2$ and $x_{iK}$ is such that the Grenander conditions are met, then the asymptotic distribution fo $\bm{b}$ is


\begin{equation}
  \label{eq:badistrb}
 \bm{b}\sim N\left[\bm{\hat \beta},\frac{\sigma^2}{n}\bm{Q}^{-1}\right]
\end{equation}

Whereas $\frac{1}{n}\bm{Q}^{-1}$ is estimated with $\left(\bm{X}^\top\bm{X}\right)^{-1}$ and $\sigma^2$ with $\bm{\frac{e^\top e}{(n-K)}}$.

Assuming a multivariate normal distribution for $\bm{b}$ the discount fuction is also normally distributed


\begin{equation}
  \label{eq:ddistr}
  d(m_{i,j}) \sim N\left[1+\bm{g}^\top\bm{\hat\beta},\bm{g}^\top\left[\sigma^2(\bm{X^\top X})^{-1} \right]\bm{g} \right]
\end{equation} 
\textcolor{red}{Always write $d(m_{i,j},\bm{\beta})$ ?}

From an economic point of view only positive interest rates make sense. Therefore, all discount factors for which a cashflow occurs are nonnegative, $d(m_{i,j})>0 \qquad  \forall m_{i,j}> 0$. \textcolor{red}{Explain this more in detail in section \ref{sec:notation}.}


\cite{McCulloch1975} plots error bands above and below one standard error of the best estimate. A confidence interval that would have been constructed the usual way, could get to the negative. Negative discount factors can not be transformed to spot rates with \eqref{eq:transformdf}. Therefore a we suggest to use the truncated normal distribution for the construction of the confidence interval of the discount function $d(m_{i,j})$.

 
The density of the truncated normal distribution can be written as

\begin{equation}
  \label{eq:dtdistrb}
  f\left(d(m_{i,j})|d(m_{i,j}> 0)\right) = \frac{\frac{1}{\sigma}\phi (\frac{d-\mu}{\sigma} )}{1 - \Phi(\frac{-\mu}{\sigma})} 
\end{equation}

\textcolor{red}{$d(m_{i,j})>0$}

In order to obtain the mean and variance of the truncated normal distribution we 
use the moment generation fuction, which is:


\begin{equation}
  \label{eq:mgf}
M(t) = E[e^{td(m_{i,j}}|d(m_{i,j}) > 0] = \frac{\int_0^{-\infty}e^{ty}f(y)dy}{1-\Phi(\frac{-\mu}{\sigma})} =
e^{ut + \sigma^2t^2/2}\frac{1 - \Phi(\frac{-\mu}{\sigma} - \sigma t)}{1- \Phi(\frac{-\mu}{\sigma})}
\end{equation}
From the moment generating function the mean and the variance can be derived



\begin{equation}
  \label{eq:edtd}
E\left[d(m_{i,j})|d(m_{i,j})\right] = M'(t)|_{t=0} = \mu + \sigma\frac{\phi(\frac{-\mu}{\sigma})}{1 - \Phi(\frac{-\mu}{\sigma})}
\end{equation}

\begin{eqnarray}
  \label{eq:vdtd}
Var[d(m_{i,j})|d(m_{i,j})>0] = E\left[d(m_{i,j})^2|d(m_{i,j})\right] = M''(t)|_{t=0} \nonumber \\
=  \sigma^2\left[1+ \frac{\frac{-\mu}{\sigma}\phi(\frac{-\mu}{\sigma})}{1-\Phi(\frac{-\mu}{\sigma})} -\left(\frac{\phi(\frac{-\mu}{\sigma})}{1-\Phi(\frac{-\mu}{\sigma})^2} \right)\right]
\end{eqnarray}
The $1-\alpha$ confidence interval for $d(m_{i,j})$, assuming a truncated normal distribution,
can be written as

\begin{equation}
  \label{eq:cfdtd}
\mbox{P}[c_1\le d(m_{i,j}) \le c_2] = \int_{c_1}^{c_2}f(y(m_{i,j}|y(m_{i,j})>0)dy =  1 - \alpha
\end{equation}

The upper and the lower confidence intervall $c_1$ and $c_2$ for the discount function are converted with \eqref{eq:transformdf} to a confidence interval for the spot rate function. Because $c_1$ is forced to be non negative with the truncated normal distribution, it is now possible to evaluate the logarithm in the transformation to the spot rate function.


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "jss-termstrc"
%%% End: 
